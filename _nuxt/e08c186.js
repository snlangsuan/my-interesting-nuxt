(window.webpackJsonp=window.webpackJsonp||[]).push([[11,6],{563:function(t,e,n){var content=n(646);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(25).default)("6a2f6dac",content,!0,{sourceMap:!1})},645:function(t,e,n){"use strict";n(563)},646:function(t,e,n){var o=n(24)(!1);o.push([t.i,"@import url(https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;500;600;700&display=swap);"]),o.push([t.i,".upload-field[data-v-174f0075]{position:relative}.upload-field__wrap[data-v-174f0075]{border:thin dashed #1967d2!important;border-radius:4px;padding:8px;display:flex;align-items:center;cursor:pointer;position:relative;margin-bottom:4px;width:100%;height:240px;background-color:#e8f0fe;overflow:hidden}.upload-field--error[data-v-174f0075]{border:2px solid #ff5252!important}.upload-field__disabled[data-v-174f0075]{position:absolute;top:0;bottom:0;left:0;right:0}.upload-field__details[data-v-174f0075]{margin-bottom:8px;padding:0 12px;display:flex;flex:1 0 auto;max-width:100%;min-height:14px;overflow:hidden}.upload-field__details--hide[data-v-174f0075]{display:none!important}.upload-field--readonly[data-v-174f0075]{cursor:auto}.upload-field__input[data-v-174f0075]{z-index:9;width:100%;opacity:0}.upload-field__img[data-v-174f0075],.upload-field__input[data-v-174f0075]{position:absolute;top:0;left:0;right:0;bottom:0}.upload-field__text[data-v-174f0075]{flex:100%;position:relative;text-align:center}.upload-field--error>.upload-field__text>*>*[data-v-174f0075]{color:#dd2c00}.upload-field__wrap:not(.upload-field--disabled) .upload-field__remove>*[data-v-174f0075]{color:#dd2c00!important}.upload-field__wrap:not(.upload-field--error):not(.upload-field--disabled):hover>.upload-field__text>*>*[data-v-174f0075]{color:#1aa24e}",""]),t.exports=o},653:function(t,e){},654:function(t,e){},662:function(t,e){},702:function(t,e){},703:function(t,e){},704:function(t,e){},705:function(t,e,n){var content=n(777);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(25).default)("3f5c45a6",content,!0,{sourceMap:!1})},714:function(t,e,n){"use strict";n.r(e);n(47),n(5),n(33),n(61),n(48),n(26),n(9),n(62),n(66),n(50);var o=n(21),l=n(706),r=n.n(l);function d(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,r=!0,d=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){d=!0,l=t},f:function(){try{r||null==n.return||n.return()}finally{if(d)throw l}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var f={name:"UploadImageField",extends:n(517).a,inject:{form:{default:null}},props:{value:{type:String,default:""},src:{type:String,default:""},addText:{type:String,default:"เพิ่มภาพ"},removeText:{type:String,default:"นำออก"},accept:{type:String,default:"image/png,image/jpg"}},data:function(){return{url:"",localValue:"",originalFile:null}},watch:{value:function(t){this.localValue=t},src:function(t){this.url=t}},mounted:function(){this.valid=!0,this.url=this.src,this.localValue=this.value},created:function(){this.form&&this.form.register(this)},beforeDestroy:function(){this.form&&this.form.unregister(this)},methods:{validate:function(t,e){if(t){var n=[];e=e||this.localValue,t&&(this.hasInput=this.hasFocused=!0);var l,r=d(this.rules);try{for(r.s();!(l=r.n()).done;){var c=l.value,f="function"==typeof c?c(e):c;"string"==typeof f?n.push(f):"boolean"!=typeof f&&console.error("Rules should return a string or boolean, received '".concat(Object(o.a)(f),"' instead"),this)}}catch(t){r.e(t)}finally{r.f()}return this.errorBucket=n,this.valid=0===n.length,this.valid}},reset:function(){this.valid=!0,this.url="",this.localValue="",this.originalFile=null,this.errorBucket=[],this.$emit("input",this.localValue)},resetValidation:function(){this.valid=!0,this.errorBucket=[]},getOriginalFile:function(){return this.originalFile},onRemove:function(){this.disabled||(this.url="",this.localValue="",this.originalFile=null,this.$emit("input",this.localValue),this.validate(!0,this.localValue))},onSelectImage:function(){this.disabled||this.$refs.picture_upload.click()},onChangeImage:function(){var t=this,input=this.$refs.picture_upload.files;if(input&&input[0])new r.a(input[0],{convertSize:5e6,maxWidth:1040,success:function(e){var n=new FileReader;n.onload=function(n){t.localValue=n.target.result,t.$emit("input",t.localValue),t.$emit("change",t.localValue,e),t.$refs.picture_upload.value=null,t.$refs.picture_upload.type="text",t.$refs.picture_upload.type="file",t.validate(!0,t.localValue)},n.readAsDataURL(e),t.originalFile=e}})},onToggleAction:function(){this.readOnly||this.disabled||this.onSelectImage()}}},v=(n(645),n(65)),h=n(79),m=n.n(h),_=n(197),x=n(169),w=n(505),component=Object(v.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"upload-field"},[n("div",{class:["upload-field__wrap",{"upload-field--error":!t.valid,"upload-field--disabled":t.disabled}],on:{click:t.onToggleAction}},[n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"picture_upload",staticClass:"upload-field__input",attrs:{type:"file",alt:"",title:"",accept:t.accept},on:{input:t.onChangeImage}}),t._v(" "),t.localValue?n("div",{staticClass:"upload-field__img"},[n("v-img",{staticClass:"grey lighten-4",attrs:{src:t.localValue,width:"100%",height:"100%",contain:""}})],1):t.src?n("div",[n("v-img",{staticClass:"grey lighten-4",attrs:{src:t.url,width:"100%",height:"100%",contain:""}})],1):n("div",{class:["upload-field__text"]},[n("div",{staticClass:"mx-auto mt-4"},[n("v-icon",{attrs:{color:"#1967d2",size:"18",left:""}},[t._v("mdi-tray-arrow-up")]),t._v(" "),n("span",{staticClass:"text-body-2",staticStyle:{color:"#1967d2"}},[t._v(t._s(t.addText))])],1)])]),t._v(" "),n("div",{class:["upload-field__details",{"upload-field__details--hide":t.hideDetails}]},[t.errorBucket.length<1&&t.hint&&(t.persistentHint||t.isFocused)?n("VMessages",{attrs:{value:[t.hint]}}):t._e(),t._v(" "),n("VMessages",{attrs:{value:t.errorBucket,color:"error"}})],1)])}),[],!1,null,"174f0075",null);e.default=component.exports;m()(component,{VIcon:_.a,VImg:x.a,VMessages:w.a})},715:function(t,e,n){"use strict";n.r(e);n(28),n(5);var o={name:"BoundingBoxCanvas",props:{width:{type:Number,default:100},height:{type:Number,default:100},src:{type:String,default:null}},data:function(){return{stageConfig:{width:100,height:100},imageConfig:{image:null,width:100,height:100,x:0,y:0,scaleX:1,scaleY:1}}},watch:{src:function(t){this.imageConfig.image=t}},mounted:function(){},methods:{loadImage:function(t){if(t)return new Promise((function(e,n){var image=new Image;image.onload=function(){e(image)},image.src=t}))}}},l=n(65),component=Object(l.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{style:{width:t.width+"px",height:t.height+"px"}},[n("v-stage",{ref:"stage",attrs:{config:t.stageConfig}},[n("v-layer",{ref:"layer"},[n("v-image",{attrs:{config:t.imageConfig}})],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports},776:function(t,e,n){"use strict";n(705)},777:function(t,e,n){var o=n(24)(!1);o.push([t.i,"@import url(https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;500;600;700&display=swap);"]),o.push([t.i,".ad-detection-page[data-v-5278a174]{padding:8px;display:flex;align-items:center;justify-content:center}.ad-detection-database[data-v-5278a174]{padding-top:8px;display:flex}.ad-detection-database-list[data-v-5278a174]{overflow:hidden;overflow-x:auto;margin-left:8px;display:flex}.ad-detection-database-item[data-v-5278a174]{width:58px;height:58px}.ad-detection-database-list>.ad-detection-database-item+.ad-detection-database-item[data-v-5278a174]{margin-left:4px}.ad-detection-workspace[data-v-5278a174]{display:flex}.ad-detection__container[data-v-5278a174]{max-width:800px;width:100%;margin:auto}.ad-detection-upload-btn[data-v-5278a174]{width:72px;height:58px;padding:4px 8px;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#e8f0fe;border-radius:4px;cursor:pointer;position:relative}.ad-detection-upload-btn>input[data-v-5278a174]{display:none}.ad-detection-upload-btn>.ad-detection-upload-btn__text[data-v-5278a174],.ad-detection-upload-btn>i[data-v-5278a174]{color:#1967d2}.ad-detection-upload-btn>.ad-detection-upload-btn__text[data-v-5278a174]{font-size:.8rem}.ad-detection-upload-btn[data-v-5278a174]:hover{background-color:#d2e3fc}",""]),t.exports=o},824:function(t,e,n){"use strict";n.r(e);n(5),n(93);var o=n(27),l=n(51),r=n(44),d=n(31),c=n(37),f=n(36),v=(n(90),n(713));function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=Object(d.a)(t);if(e){var l=Object(d.a)(this).constructor;n=Reflect.construct(o,arguments,l)}else n=o.apply(this,arguments);return Object(r.a)(this,n)}}var m=Object(c.a)((function t(e){return Object(f.a)(this,t),v.f.l1l2(e)}));m.className="L2",v.i.registerClass(m);var _=function(t){Object(l.a)(n,t);var e=h(n);function n(){return Object(f.a)(this,n),e.call(this,{})}return Object(c.a)(n,null,[{key:"className",get:function(){return"Lambda"}}]),n}(v.c.Layer);v.i.registerClass(_);var x={name:"AdDetectionPage",layout:"ml",data:function(){return{title:"Ad Detection",databases:[],uploadDatabaseDialog:!1,createDatabaseValid:!0,createDatabase:{label:"",img:""},initializing:!1,databaseUpdating:!1,isPreviewUploaded:!1,embeddingModel:null,canvasWidth:100,canvasHeight:100,testImg:null,testOriginalSize:{w:0,h:0},testResize:{w:0,h:0}}},head:function(){return{title:this.title}},watch:{uploadDatabaseDialog:function(t){var e=this;this.$nextTick((function(){e.$refs.database_form.reset()}))}},mounted:function(){this.initialize()},methods:{initialize:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.initializing=!0,e.next=4,v.d("/models/detection-offline-ad/model.json");case 4:n=e.sent,console.log(n),t.embeddingModel=n,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:return e.prev=12,t.initializing=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])})))()},onResize:function(){var t=document.querySelector("#workspace");if(t){var e=t.offsetWidth-32;this.canvasWidth=Math.round(.6*e),this.canvasHeight=this.canvasWidth,console.log(e)}},resizeCanvas:function(){var t=document.querySelector("#workspace");t&&console.log(t.offsetWidth)},handleAddDatabase:function(){var t=this;if(this.$refs.database_form.validate())try{this.databaseUpdating=!0,console.log("upload",this.createDatabase);var image=new Image;image.onload=function(){var e=v.b.fromPixels(image).resizeNearestNeighbor([224,224]).toFloat().div(v.g(255)).expandDims(),n=t.embeddingModel.predict(e);t.databases.push({id:Date.now(),img:t.createDatabase.img,label:t.createDatabase.label,embedded:n.arraySync()}),t.uploadDatabaseDialog=!1},image.src=this.createDatabase.img}catch(t){}finally{this.databaseUpdating=!1}},handleOnUploadTest:function(t,e){var n=this;this.isPreviewUploaded=!0,this.$nextTick((function(){var canvas=document.getElementById("workspace_canvas"),e=canvas.getContext("2d"),image=new Image;image.onload=function(){n.testOriginalSize.w=image.width,n.testOriginalSize.h=image.height;var t=n.calculateAspectRatioFit(image.width,image.height,n.canvasWidth,n.canvasHeight);console.log(t,n.canvasWidth,n.canvasHeight);var o=Math.min(t.width/image.width,t.height/image.height);e.scale(o,o),e.drawImage(image,0,0),e.scale(1/o,1/o),canvas.style.width=t.width+"px",canvas.style.height=t.height+"px"},image.src=t}))},calculateAspectRatioFit:function(t,e,n,o){var l=Math.min(n/t,o/e);return{width:t*l,height:e*l}}}},w=(n(776),n(65)),y=n(79),D=n.n(y),k=n(292),C=n(707),V=n(597),I=n(822),S=n(820),j=n(821),O=n(197),z=n(169),A=n(458),$=n(828),R=n(791),F=n.n(R),M=n(215),component=Object(w.a)(x,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"resize",rawName:"v-resize",value:t.onResize,expression:"onResize"}],staticClass:"ad-detection-page fill-height"},[n("div",{staticClass:"ad-detection__container"},[n("v-card",[n("v-card-title",{staticClass:"py-2"},[n("div",[t._v("Artwork")]),t._v(" "),n("v-spacer"),t._v(" "),n("v-btn",{attrs:{icon:""}},[n("v-icon",[t._v("mdi-dots-vertical")])],1)],1),t._v(" "),n("v-divider"),t._v(" "),n("v-card-text",[t.databases.length>0?n("div",[t._v(t._s(t.databases.length)+" Image samples")]):n("div",[t._v("Add Image samples:")]),t._v(" "),n("div",{staticClass:"ad-detection-database"},[n("div",{staticClass:"ad-detection-upload-btn",on:{click:function(e){t.uploadDatabaseDialog=!0}}},[n("v-icon",{attrs:{size:"18"}},[t._v("mdi-tray-arrow-up")]),t._v(" "),n("div",{staticClass:"ad-detection-upload-btn__text"},[t._v("Upload")])],1),t._v(" "),n("div",{staticClass:"ad-detection-database-list"},[t._l(t.databases,(function(t){return[n("div",{key:t.id,staticClass:"ad-detection-database-item"},[n("v-img",{attrs:{src:t.img,width:"100%",contain:""}})],1)]}))],2)])])],1),t._v(" "),n("v-card",{staticClass:"mt-8",attrs:{id:"workspace"}},[n("v-card-title",[t._v("Preview")]),t._v(" "),n("v-divider"),t._v(" "),t.databases.length>0&&!t.isPreviewUploaded?n("v-card-text",[n("upload-image-field",{ref:"upload_test",staticStyle:{width:"100%"},attrs:{"add-text":"คลิกหรือลากวาง",accept:"image/jpeg","hide-details":""},on:{change:t.handleOnUploadTest},model:{value:t.testImg,callback:function(e){t.testImg=e},expression:"testImg"}})],1):t.isPreviewUploaded?n("v-card-text",[n("div",{staticClass:"ad-detection-workspace"},[n("div",{staticClass:"ad-detection-workspace__canvas"},[n("bounding-box-canvas",{attrs:{width:t.canvasWidth,height:t.canvasHeight}})],1),t._v(" "),n("div",{staticClass:"ad-detection-workspace__output"})])]):n("v-card-text",[t._v("\n        You must add artwork on top panel before you can preview it here\n      ")])],1)],1),t._v(" "),n("v-dialog",{attrs:{"max-width":"480",persistent:""},model:{value:t.uploadDatabaseDialog,callback:function(e){t.uploadDatabaseDialog=e},expression:"uploadDatabaseDialog"}},[n("v-card",[n("v-card-title",[t._v("Add new artwork")]),t._v(" "),n("v-card-text",[n("v-form",{ref:"database_form",on:{submit:function(t){t.preventDefault()}},model:{value:t.createDatabaseValid,callback:function(e){t.createDatabaseValid=e},expression:"createDatabaseValid"}},[n("v-text-field",{attrs:{label:"Label",rules:[function(t){return!!t||"Enter label name"}],dense:"",outlined:""},model:{value:t.createDatabase.label,callback:function(e){t.$set(t.createDatabase,"label",e)},expression:"createDatabase.label"}}),t._v(" "),n("upload-image-field",{ref:"upload_database",staticStyle:{width:"100%"},attrs:{rules:[function(t){return!!t||"Enter image"}],"add-text":"คลิกหรือลากวาง",accept:"image/jpeg"},model:{value:t.createDatabase.img,callback:function(e){t.$set(t.createDatabase,"img",e)},expression:"createDatabase.img"}})],1)],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{text:""},on:{click:function(e){t.uploadDatabaseDialog=!1}}},[t._v("cancel")]),t._v(" "),n("v-btn",{attrs:{color:"primary",text:""},on:{click:t.handleAddDatabase}},[t._v("add")])],1)],1)],1)],1)}),[],!1,null,"5278a174",null);e.default=component.exports;D()(component,{UploadImageField:n(714).default,BoundingBoxCanvas:n(715).default}),D()(component,{VBtn:k.a,VCard:C.a,VCardActions:V.a,VCardText:V.b,VCardTitle:V.c,VDialog:I.a,VDivider:S.a,VForm:j.a,VIcon:O.a,VImg:z.a,VSpacer:A.a,VTextField:$.a}),F()(component,{Resize:M.a})}}]);