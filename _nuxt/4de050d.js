(window.webpackJsonp=window.webpackJsonp||[]).push([[12,6],{1052:function(e,t,n){"use strict";n.r(t);n(40),n(37),n(45),n(39),n(46),n(96),n(128),n(95),n(129),n(137);var r=n(15),o=n(63),l=(n(134),n(150),n(403),n(356),n(38),n(25),n(117),n(136),n(70),n(65),n(69),n(97),n(57),n(159),n(275),n(187),n(816)),d=n.n(l),c=n(777);function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){d=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(d)throw o}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var _={name:"AdDetectionPage",layout:"ml",data:function(){return{title:"Offline-advertising Detection",loading:{show:!0,message:"Getting model version..."},initializing:!0,hideDatabase:!1,hasChangVersion:!1,hasProblem:!1,hideOptions:!1,sampleUploaded:!1,uploadDatabaseDialog:!1,createDatabaseValid:!0,createDatabase:{label:"",img:[]},screenWidth:0,canvasWidth:0,canvasHeight:0,contentHeight:0,modelVersion:"0.0",embeddingModel:null,minimumSimilarityThreshold:.4,minimumLocalizationThreshold:.7,viewLabels:[],databases:[],samples:[],uploads:[],tempImage:null,resizeObserver:null}},mounted:function(){this.initialize(),this.resizeObserver||(this.resizeObserver=new ResizeObserver(this.onResize));var e=document.querySelector(".page-database");e&&this.resizeObserver.observe(e);var t=document.querySelector(".page-filter");t&&this.resizeObserver.observe(t)},beforeDestroy:function(){var e=document.querySelector(".page-database");e&&this.resizeObserver&&this.resizeObserver.unobserve(e);var t=document.querySelector(".page-filter");t&&this.resizeObserver&&this.resizeObserver.unobserve(t)},methods:{initialize:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.initializing=!0,e.loading.message="Getting model version...",e.loading.show=!0,t.next=6,e.getModelVersion();case 6:if(e.loading.message="Loading model...",!localStorage.getItem("detection-offline-ad")){t.next=15;break}return t.next=11,e.$tfjs.loadLayersModel("indexeddb://detection-offline-ad");case 11:n=t.sent,e.embeddingModel=n,t.next=22;break;case 15:return t.next=17,e.$tfjs.loadLayersModel("https://storage.googleapis.com/demo-ml-model/detection-offline-ad/model.json");case 17:return r=t.sent,e.embeddingModel=r,t.next=21,r.save("indexeddb://detection-offline-ad");case 21:localStorage.setItem("detection-offline-ad",!0);case 22:e.loading.message="Loading database...",e.loadDatabaseLocalStorage(),e.hasChangVersion&&(e.loading.message="Re-generate database...",e.reversionDatabase()),t.next=30;break;case 27:t.prev=27,t.t0=t.catch(0),console.error(t.t0);case 30:return t.prev=30,e.initializing=!1,e.loading.show=!1,t.finish(30);case 34:case"end":return t.stop()}}),t,null,[[0,27,30,34]])})))()},setResizeObserver:function(){var e=this;setTimeout((function(){e.resizeObserver||(e.resizeObserver=new ResizeObserver(e.onResize));var t=document.querySelector(".page-database");t&&e.resizeObserver.observe(t);var n=document.querySelector(".page-filter");n&&e.resizeObserver.observe(n)}),200)},onResize:function(){console.log("change size");var e=document.querySelector(".page-database__container"),t=document.querySelector(".page-workspace");if(this.screenWidth=window.innerWidth,e&&t){var n=e.offsetWidth-32,r=this.screenWidth>560?.6:1;this.canvasWidth=Math.round(n*r)-32,this.canvasHeight=this.canvasWidth;var o=window.innerHeight,l=t.offsetTop;this.contentHeight=o-l,console.log("height",o,this.contentHeight,l,"width",this.canvasWidth)}},handleOnAddDatabase:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,image,r,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.database_form.validate()){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n=JSON.parse(JSON.stringify(e.createDatabase)),e.uploadDatabaseDialog=!1,e.loading.message="Adding Image to database...",e.loading.show=!0,t.next=9,e.base64ToImage(e.createDatabase.img[0]);case 9:image=t.sent,r=e.getEmbedded(image),o=Date.now(),l=d()(o).toHex(),e.databases.push({id:o,img:n.img[0],label:n.label,embedded:r,color:l}),e.trainingModel(e.databases),e.updateDatabaseLocalStorage(e.databases),e.viewLabels=e.databases.map((function(e){return e.id})),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(2),console.error("add database error",t.t0);case 22:return t.prev=22,e.loading.show=!1,t.finish(22);case 25:case"end":return t.stop()}}),t,null,[[2,19,22,25]])})))()},handleOnUploadDatabase:function(){var e=this;this.createDatabase={label:"",img:[]},this.uploadDatabaseDialog=!0,this.$nextTick((function(){e.$refs.database_form.reset(),e.$refs.database_form.resetValidation()}))},handleOnResetReferences:function(){try{this.databases=[],localStorage.removeItem("offline-ad-databases")}catch(e){console.error("remove database",e)}},handleOnRemoveReference:function(e){if(e)try{var t=this.databases.findIndex((function(t){return t.id===e}));t>-1&&(this.databases.splice(t,1),this.trainingModel(this.databases),this.updateDatabaseLocalStorage(this.databases))}catch(e){console.error("remove database error",e)}},handleOnReloadPage:function(){window.location.reload()},handleOnResetSample:function(){this.uploads=[],this.samples=[],this.sampleUploaded=!1},filterBoxes:function(e){var t=this;return e.filter((function(e){return e.score>=t.minimumSimilarityThreshold&&e.detection_confidence>=t.minimumLocalizationThreshold&&t.viewLabels.includes(e.object_id)}))},handleOnSampleUpload:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,i,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,e.loading.message="Finding Offline advertise...",e.loading.show=!0,n=e.$refs.sample_upload.getRaws(),r=[],t.t0=regeneratorRuntime.keys(e.uploads);case 6:if((t.t1=t.t0()).done){t.next=16;break}return i=t.t1.value,e.loading.message="".concat(Number(i)+1,"/").concat(e.uploads.length,"\nFinding Offline advertise..."),o=e.uploads[i],t.next=12,e.getOfflineAdsApi(o);case 12:l=t.sent,r.push({id:Date.now()+i,name:n[i].name,image:o,boxes:l}),t.next=6;break;case 16:e.uploads=[],e.samples=r,e.sampleUploaded=!0,e.setResizeObserver(),e.onResize(),t.next=26;break;case 23:t.prev=23,t.t2=t.catch(0),console.error(t.t2);case 26:return t.prev=26,e.loading.show=!1,t.finish(26);case 29:case"end":return t.stop()}}),t,null,[[0,23,26,29]])})))()},getOfflineAdsApi:function(image){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var body,n,r,o,l,i,d,c,f,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return body={image:image.split(",")[1],threshold:0},t.next=3,e.$axios.$post("https://ad-detection-service-bxltsvmqda-as.a.run.app/ads/detection",body);case 3:return n=t.sent,r=n.objects,e.tempImage=image,t.next=8,new Promise((function(e){return setTimeout(e,1e3)}));case 8:return t.next=10,e.$refs.temp_canvas.getImageData(r);case 10:for(i in o=t.sent,l=[],o)d=o[i],c=r[i],f=e.getEmbedded(d),(v=e.querySimilarity(f))&&l.push(m(m({},n.objects[i]),{},{object:v.label,object_id:v.id,score:v.score,color:v.color,detection_confidence:c.confidence,id:Date.now()+i,$index:Number(i)}));return t.abrupt("return",l);case 14:case"end":return t.stop()}}),t)})))()},loadDatabaseLocalStorage:function(){try{var e=localStorage.getItem("offline-ad-databases");e&&(this.databases=JSON.parse(e),this.viewLabels=this.databases.map((function(e){return e.id})),this.trainingModel(this.databases))}catch(e){console.error("load database error",e)}},reversionDatabase:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,o,image;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=f(e.databases),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=11;break}return o=r.value,t.next=7,e.base64ToImage(o.img);case 7:image=t.sent,o.embedded=e.getEmbedded(image);case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),n.e(t.t0);case 16:return t.prev=16,n.f(),t.finish(16);case 19:e.trainingModel(e.databases),e.updateDatabaseLocalStorage(e.databases);case 21:case"end":return t.stop()}}),t,null,[[1,13,16,19]])})))()},base64ToImage:function(e){return new Promise((function(t,n){var image=new Image;image.onload=function(){t(image)},image.src=e}))},getEmbedded:function(img){var e=this.$tfjs.browser.fromPixels(img).resizeNearestNeighbor([224,224]).toFloat().div(this.$tfjs.scalar(255)).expandDims();return this.embeddingModel.predict(e).arraySync()[0]},trainingModel:function(e){var t=e.map((function(e){return e.embedded})),n=e.map((function(e){return e.id}));this.knn={embedded:t,labels:n}},getModelVersion:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.$get("https://storage.googleapis.com/demo-ml-model/detection-offline-ad/version.json");case 3:n=t.sent,r=localStorage.getItem("detection-offline-ad-version"),e.hasChangVersion=!1,r!==n.version&&(localStorage.removeItem("detection-offline-ad"),window.indexedDB.deleteDatabase("detection-offline-ad"),localStorage.setItem("detection-offline-ad-version",n.version),e.hasChangVersion=!0),e.modelVersion=n.version,t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),e.hasProblem=!0;case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},chkLabelDuplicate:function(label){return!this.databases.find((function(e){return e.label===label}))||"Label already exists."},queryDatabase:function(e){return this.databases.find((function(t){return t.id===e}))},updateDatabaseLocalStorage:function(e){try{localStorage.setItem("offline-ad-databases",JSON.stringify(e))}catch(e){console.error("update database error",e)}},querySimilarity:function(e){var t=this.knn.embedded,n=this.knn.labels,r=-1,o=0;for(var i in t){var l=t[i],d=Object(c.cosineSimilarity)(l,e);d>o&&(r=n[i],o=d)}if(-1===r||o<0)return null;var f=this.queryDatabase(r);return{id:r,label:null==f?void 0:f.label,score:o,color:null==f?void 0:f.color}}}},x=(n(986),n(138)),w=n(160),y=n.n(w),k=n(544),C=n(879),O=n(742),D=n(1046),S=n(1059),V=n(999),j=n(1047),R=n(1002),z=n(1003),I=n(381),$=n(351),A=n(382),M=n(266),L=n(188),T=n(1049),P=n(386),B=n(880),E=n(722),F=n(1050),U=n(728),W=n(1058),H=n(1051),component=Object(x.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page__container"},[n("div",{staticClass:"page-database"},[n("div",{staticClass:"page-database__container"},[n("v-card",[n("v-card-title",{staticClass:"py-2"},[n("v-btn",{class:["mr-2",e.hideDatabase?"page-btn--up":"page-btn--down"],attrs:{icon:"",small:""},on:{click:function(t){e.hideDatabase=!e.hideDatabase}}},[n("v-icon",[e._v("mdi-chevron-down")])],1),e._v(" "),n("div",[e._v("References")]),e._v(" "),n("v-spacer"),e._v(" "),e.databases.length>0&&e.samples.length<1?n("v-menu",{attrs:{bottom:"",left:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({attrs:{small:"",icon:""}},"v-btn",o,!1),r),[n("v-icon",[e._v("mdi-dots-vertical")])],1)]}}],null,!1,3448670655)},[e._v(" "),n("v-list",[n("v-list-item",{on:{click:e.handleOnResetReferences}},[n("v-list-item-title",[e._v("\n                  Reset References\n                ")])],1)],1)],1):e._e()],1),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[n("div",{class:["page-database--expand",{"page-database--collapse":e.hideDatabase}]},[e.databases.length>0?n("div",[e._v("\n              "+e._s(e.databases.length)+" References "),e.samples.length>0?n("span",[e._v("(Disabled add/remove)")]):e._e()]):n("div",[e._v("Add Reference:")]),e._v(" "),n("div",{staticClass:"page-database__content"},[e.samples.length<1?n("button",{staticClass:"page-database-upload-btn",on:{click:e.handleOnUploadDatabase}},[n("v-icon",{attrs:{size:"18"}},[e._v("mdi-tray-arrow-up")]),e._v(" "),n("div",{staticClass:"page-database-upload-btn__text"},[e._v("Upload")])],1):e._e(),e._v(" "),n("div",{staticClass:"page-database-list"},[e._l(e.databases,(function(t){return[n("div",{key:t.id,staticClass:"page-database-item"},[n("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(r){var o=r.on,l=r.attrs;return[n("div",e._g(e._b({},"div",l,!1),o),[n("v-img",{attrs:{src:t.img,width:"100%",contain:""}}),e._v(" "),e.samples.length<1?n("div",{staticClass:"page-database-item__remove"},[n("v-btn",{attrs:{icon:"",small:""},on:{click:function(n){return e.handleOnRemoveReference(t.id)}}},[n("v-icon",{attrs:{color:"white"}},[e._v("\n                                mdi-close-circle\n                              ")])],1)],1):e._e()],1)]}}],null,!0)},[e._v(" "),n("span",[e._v(e._s(t.label))])])],1)]}))],2)])])])],1)],1)]),e._v(" "),e.sampleUploaded?n("div",{staticClass:"page-filter pt-2"},[n("div",{staticClass:"page-filter__container"},[n("v-card",{attrs:{color:"transparent",flat:""}},[n("v-card-title",{staticClass:"py-2"},[n("div",{staticClass:"text-body-2"},[e._v(e._s(e.samples.length)+" Images uploaded")]),e._v(" "),n("v-spacer"),e._v(" "),n("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-icon",e._g(e._b({attrs:{icon:""},on:{click:e.handleOnResetSample}},"v-icon",o,!1),r),[e._v("\n                mdi-refresh\n              ")])]}}],null,!1,283694463)},[e._v(" "),n("span",[e._v("Reset")])]),e._v(" "),n("v-btn",{class:["ml-2",e.hideOptions?"page-btn--up":"page-btn--down"],attrs:{icon:"",small:""},on:{click:function(t){e.hideOptions=!e.hideOptions}}},[n("v-icon",[e._v("mdi-chevron-down")])],1)],1),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[n("div",{class:["page-filter--expand",{"page-filter--collapse":e.hideOptions}]},[n("v-row",{attrs:{dense:""}},[n("v-col",{attrs:{cols:"6"}},[n("div",{staticClass:"mb-1"},[e._v("Localization threshold ("+e._s(e._f("decimal")(e.minimumLocalizationThreshold))+")")]),e._v(" "),n("v-slider",{attrs:{min:"0",max:"1",step:"0.1",dense:"","hide-details":""},model:{value:e.minimumLocalizationThreshold,callback:function(t){e.minimumLocalizationThreshold=t},expression:"minimumLocalizationThreshold"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("div",{staticClass:"mb-1"},[e._v("Similarity threshold ("+e._s(e._f("decimal")(e.minimumSimilarityThreshold))+")")]),e._v(" "),n("v-slider",{attrs:{min:"0",max:"1",step:"0.1",dense:"","hide-details":""},model:{value:e.minimumSimilarityThreshold,callback:function(t){e.minimumSimilarityThreshold=t},expression:"minimumSimilarityThreshold"}})],1)],1),e._v(" "),n("v-row",{attrs:{dense:""}},[n("v-col",[n("div",{staticClass:"mb-1"},[e._v("Labels")]),e._v(" "),n("v-chip-group",{attrs:{column:"",multiple:""},model:{value:e.viewLabels,callback:function(t){e.viewLabels=t},expression:"viewLabels"}},[e._l(e.databases,(function(t){return[n("v-chip",{key:"lb-"+t.id,attrs:{value:t.id,color:t.color,filter:"",outlined:"",small:""}},[e._v("\n                      "+e._s(t.label)+"\n                    ")])]}))],2)],1)],1)],1)])],1)],1)]):e._e(),e._v(" "),n("div",{staticClass:"page-workspace pt-0"},[e.sampleUploaded?n("div",{staticClass:"page-workspace-list",style:{maxHeight:e.contentHeight+"px"}},[e._l(e.samples,(function(t){return[n("div",{key:"sample-"+t.id,staticClass:"page-workspace-item"},[n("v-card",{staticClass:"page-workspace-card"},[n("v-card-text",[n("div",{staticClass:"page-workspace-card__content",style:{display:e.screenWidth>560?"flex":"block"}},[n("div",{staticClass:"page-workspace-card__canvas"},[n("bounding-box-canvas",{ref:"image_canvas",refInFor:!0,attrs:{src:t.image,bboxes:e.filterBoxes(t.boxes),width:e.canvasWidth,height:e.canvasHeight}})],1),e._v(" "),n("div",{staticClass:"page-workspace-card__output"},[n("div",{class:["page-workspace-boxes-results",e.screenWidth>560?"pl-4":"pt-4"],style:{maxHeight:e.canvasHeight+"px"}},[n("div",{staticClass:"page-workspace-boxes__title"},[e._v("Predictions")]),e._v(" "),n("div",{staticClass:"page-workspace-boxes__subtitle",staticStyle:{"margin-bottom":"8px"}},[e._v(e._s(e.filterBoxes(t.boxes).length)+" objects")]),e._v(" "),e._l(e.filterBoxes(t.boxes),(function(r,i){return[n("div",{key:"output-"+t.id+"-"+i,staticClass:"page-workspace-boxes__item"},[n("div",{staticClass:"page-workspace-boxes__color-box",style:{backgroundColor:r.color}},[e._v("\n                          "+e._s("P"+(r.$index+1))+"\n                        ")]),e._v(" "),n("div",{staticClass:"page-workspace-boxes__label"},[e._v("\n                          "+e._s(r.object)+"\n                        ")]),e._v(" "),n("div",{staticClass:"page-workspace-boxes__percent"},[n("v-progress-linear",{attrs:{value:100*r.score,height:"10"}})],1),e._v(" "),n("div",{staticClass:"page-workspace-boxes__score"},[e._v("\n                          "+e._s(Math.ceil(100*r.score))+"%\n                        ")])])]}))],2)])])])],1)],1)]}))],2):n("div",{staticClass:"page-workspace-item"},[n("v-card",{staticClass:"mt-4"},[n("v-card-title",{staticClass:"py-2"},[e._v("Preview")]),e._v(" "),n("v-divider"),e._v(" "),e.databases.length<1?n("v-card-text",[e._v("\n          You must add artwork on top panel before you can preview it here\n        ")]):n("v-card-text",[n("upload-image-field",{ref:"sample_upload",staticStyle:{width:"100%"},attrs:{accept:"image/jpeg",multiple:""},on:{change:e.handleOnSampleUpload},model:{value:e.uploads,callback:function(t){e.uploads=t},expression:"uploads"}})],1)],1)],1)]),e._v(" "),n("div",{staticClass:"page-footer"},[n("div",{staticClass:"page-footer__text"},[e._v("version: "+e._s(e.modelVersion))])]),e._v(" "),n("v-dialog",{attrs:{"max-width":"480",persistent:""},model:{value:e.uploadDatabaseDialog,callback:function(t){e.uploadDatabaseDialog=t},expression:"uploadDatabaseDialog"}},[n("v-card",[n("v-card-title",[e._v("Add new artwork")]),e._v(" "),n("v-card-text",{staticClass:"pb-0"},[n("v-form",{ref:"database_form",on:{submit:function(e){e.preventDefault()}},model:{value:e.createDatabaseValid,callback:function(t){e.createDatabaseValid=t},expression:"createDatabaseValid"}},[n("v-text-field",{attrs:{label:"Label",rules:[function(e){return!!e||"Enter label name"},e.chkLabelDuplicate],dense:"",outlined:""},model:{value:e.createDatabase.label,callback:function(t){e.$set(e.createDatabase,"label",t)},expression:"createDatabase.label"}}),e._v(" "),n("upload-image-field",{ref:"upload_database",staticStyle:{width:"100%"},attrs:{rules:[function(e){return!!e||"Enter image"}],"add-text":"Click to upload",accept:"image/jpeg"},model:{value:e.createDatabase.img,callback:function(t){e.$set(e.createDatabase,"img",t)},expression:"createDatabase.img"}})],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:""},on:{click:function(t){e.uploadDatabaseDialog=!1}}},[e._v("cancel")]),e._v(" "),n("v-btn",{attrs:{color:"primary",text:""},on:{click:e.handleOnAddDatabase}},[e._v("add")])],1)],1)],1),e._v(" "),n("v-overlay",{model:{value:e.loading.show,callback:function(t){e.$set(e.loading,"show",t)},expression:"loading.show"}},[n("div",{staticClass:"page__overlay-box"},[e._v(e._s(e.loading.message))])]),e._v(" "),n("v-dialog",{attrs:{"max-width":"640",persistent:""},model:{value:e.hasProblem,callback:function(t){e.hasProblem=t},expression:"hasProblem"}},[n("v-card",[n("v-card-text",{staticClass:"py-4 text-center"},[n("div",{staticClass:"py-3"},[n("v-icon",{attrs:{color:"primary",size:"48"}},[e._v("mdi-connection")])],1),e._v(" "),n("div",{staticClass:"text-h6"},[e._v("Something went wrong...")]),e._v(" "),n("div",{staticClass:"text-body-2 pb-6"},[e._v("\n          We are working on fixing the problem Please try again.\n        ")]),e._v(" "),n("v-btn",{attrs:{color:"primary",plain:""},on:{click:e.handleOnReloadPage}},[n("v-icon",{attrs:{left:""}},[e._v("mdi-refresh")]),e._v("\n          Refresh Page\n        ")],1)],1)],1)],1),e._v(" "),n("div",{staticClass:"page-temp-upload"},[n("bounding-box-canvas",{ref:"temp_canvas",attrs:{src:e.tempImage,bboxes:[],width:e.canvasWidth,height:e.canvasHeight}})],1)],1)}),[],!1,null,"196cba2f",null);t.default=component.exports;y()(component,{BoundingBoxCanvas:n(889).default,UploadImageField:n(780).default}),y()(component,{VBtn:k.a,VCard:C.a,VCardActions:O.a,VCardText:O.b,VCardTitle:O.c,VChip:D.a,VChipGroup:S.a,VCol:V.a,VDialog:j.a,VDivider:R.a,VForm:z.a,VIcon:I.a,VImg:$.a,VList:A.a,VListItem:M.a,VListItemTitle:L.b,VMenu:T.a,VOverlay:P.a,VProgressLinear:B.a,VRow:E.a,VSlider:F.a,VSpacer:U.a,VTextField:W.a,VTooltip:H.a})},741:function(e,t,n){var content=n(769);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(56).default)("5d7ada4c",content,!0,{sourceMap:!1})},761:function(e,t,n){var content=n(805);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(56).default)("4bd70fc2",content,!0,{sourceMap:!1})},768:function(e,t,n){"use strict";n(741)},769:function(e,t,n){var r=n(55)(!1);r.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;500;600;700&display=swap);"]),r.push([e.i,".upload-field[data-v-b5ade68e]{position:relative}.upload-field__content[data-v-b5ade68e]{border:thin dashed #1967d2!important;border-radius:4px;padding:8px;display:flex;align-items:center;justify-content:center;position:relative;margin-bottom:4px;width:100%;height:240px;background-color:#e8f0fe;overflow:hidden;z-index:1;color:#1967d2!important}.upload-field__content *[data-v-b5ade68e]{pointer-events:none}.upload-field__content>input[data-v-b5ade68e]{display:none}.upload-field__drop-zone[data-v-b5ade68e]{text-align:center}.upload-field--error[data-v-b5ade68e]{border:2px solid #ff5252!important}.upload-field__disabled[data-v-b5ade68e]{position:absolute;top:0;bottom:0;left:0;right:0}.upload-field__details[data-v-b5ade68e]{margin-bottom:8px;padding:0 12px;display:flex;flex:1 0 auto;max-width:100%;min-height:14px;overflow:hidden}.upload-field__details--hide[data-v-b5ade68e]{display:none!important}.upload-field--readonly[data-v-b5ade68e]{cursor:auto}.upload-field:hover .upload-field__image--remove[data-v-b5ade68e]{display:flex}.upload-field:hover .upload-field__image--remove>*[data-v-b5ade68e]{pointer-events:auto}.upload-field__image[data-v-b5ade68e],.upload-field__image--remove[data-v-b5ade68e]{position:absolute;left:0;right:0;top:0;bottom:0}.upload-field__image--remove[data-v-b5ade68e]{display:none;z-index:1;background-color:rgba(0,0,0,.25);align-items:center;justify-content:center}.upload-field__normal[data-v-b5ade68e]{text-align:center}.upload-field__normal>i[data-v-b5ade68e]{color:#1967d2}.upload-field__normal>div>div[data-v-b5ade68e]{display:inline-block;text-decoration:underline;cursor:pointer;pointer-events:auto}",""]),e.exports=r},777:function(e,t,n){"use strict";n.r(t),n.d(t,"cosineSimilarity",(function(){return o}));var r=n(779),o=function(a,b){return r.a.cosine(a,b)}},780:function(e,t,n){"use strict";n.r(t);n(96),n(69),n(128),n(95),n(37),n(129),n(137),n(97);var r=n(51),o=n(63),l=n(49),d=(n(187),n(25),n(38),n(150),n(57),n(159),n(151),n(117),n(136),n(806)),c=n.n(d);function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){d=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(d)throw o}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var h={name:"UploadImageField",extends:n(739).a,inject:{form:{default:null}},props:{value:{type:Array,default:function(){return[]}},accept:{type:String,default:"image/png,image/jpg"},imageMaxDimension:{type:Array,default:function(){return[640,640]}},multiple:{type:Boolean,default:!1}},data:function(){return{localVal:[],raws:[],fileCompressor:null,isDragging:!1,processing:!1}},watch:{value:function(e){this.localVal=e||[]}},mounted:function(){this.valid=!0,this.localVal=this.value},methods:{validate:function(e,t){if(e){var n=[];t=t||this.localVal,e&&(this.hasInput=this.hasFocused=!0);var r,o=f(this.rules);try{for(o.s();!(r=o.n()).done;){var d=r.value,c="function"==typeof d?d(t):d;"string"==typeof c?n.push(c):"boolean"!=typeof c&&console.error("Rules should return a string or boolean, received '".concat(Object(l.a)(c),"' instead"),this)}}catch(e){o.e(e)}finally{o.f()}return this.errorBucket=n,this.valid=0===n.length,this.valid}},reset:function(){this.valid=!0,this.localVal=[],this.raws=[],this.errorBucket=[],this.$emit("input",this.localVal)},resetValidation:function(){this.valid=!0,this.errorBucket=[]},getRaws:function(){return this.raws},handelOnChangeFile:function(){this.onConvertImage()},handelOnDrop:function(e){if(e.preventDefault(),!(this.disabled||this.localVal.length>0)){this.isDragging=!1;var t=e.dataTransfer.files;this.$refs.picture_upload.files=t,this.onConvertImage()}},handelOnDragEnter:function(e){e.preventDefault(),this.disabled||this.localVal.length>0||(this.isDragging=!0)},handleOnDragLeave:function(e){this.disabled||this.localVal.length>0||(this.isDragging=!1)},handleDragOver:function(e){this.disabled||this.localVal.length>0||e.preventDefault()},parseImage:function(e){var t=this;return new Promise((function(n,r){var o,l=function(e){n([e.target.result,o])};t.fileCompressor=new c.a(e,{convertSize:5e6,maxWidth:t.imageMaxDimension[0],maxHeight:t.imageMaxDimension[1],success:function(e){var t=new FileReader;t.onload=l,o=e,t.readAsDataURL(o)},error:r})}))},onConvertImage:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,l,d,c,v,h,m,_,img,x;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=e.$refs.picture_upload.files,e.multiple||(n=[n[0]]),o=e.accept.split(",").map((function(e){return e.trim()})).filter((function(e){return!!e})),l=[],d=[],e.processing=!0,c=f(n),t.prev=8,c.s();case 10:if((v=c.n()).done){t.next=24;break}if(h=v.value,o.includes(h.type)){t.next=14;break}throw new Error("Some file not support");case 14:return t.next=16,e.parseImage(h);case 16:m=t.sent,_=Object(r.a)(m,2),img=_[0],x=_[1],d.push(img),l.push(x);case 22:t.next=10;break;case 24:t.next=29;break;case 26:t.prev=26,t.t0=t.catch(8),c.e(t.t0);case 29:return t.prev=29,c.f(),t.finish(29);case 32:e.localVal=d,e.raws=l,e.$refs.picture_upload.value=null,e.$refs.picture_upload.type="text",e.$refs.picture_upload.type="file",e.$emit("input",e.localVal),e.$emit("change",e.localVal,e.raws),e.validate(!0,e.localVal),t.next=47;break;case 42:t.prev=42,t.t1=t.catch(0),console.error(t.t1),e.errorBucket[0]=t.t1.message,e.valid=!1;case 47:return t.prev=47,e.processing=!1,t.finish(47);case 50:case"end":return t.stop()}}),t,null,[[0,42,47,50],[8,26,29,32]])})))()},handelOnRemove:function(){this.localVal=[],this.raws=[],this.$emit("input",this.localVal),this.$emit("change",this.localVal,this.raws),this.validate(!0,this.localVal)}}},m=(n(768),n(138)),_=n(160),x=n.n(_),w=n(384),y=n(381),k=n(351),C=n(740),component=Object(m.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"upload-field",attrs:{id:e.id}},[n("div",{class:["upload-field__content",{"upload-field--error":!e.valid,"upload-field--disabled":e.disabled},{"upload-field-drop":e.isDragging}],attrs:{id:"upload_content"},on:{drop:e.handelOnDrop,dragover:e.handleDragOver,dragenter:e.handelOnDragEnter,dragleave:e.handleOnDragLeave}},[n("input",{ref:"picture_upload",attrs:{type:"file",alt:"",title:"",accept:e.accept,multiple:e.multiple},on:{input:e.handelOnChangeFile}}),e._v(" "),e.multiple||1!==e.localVal.length?e.isDragging?n("div",{staticClass:"upload-field__drop-zone"},[n("v-avatar",{attrs:{color:"#1967d2"}},[n("v-icon",{attrs:{dark:""}},[e._v("mdi-tray-arrow-up")])],1),e._v(" "),n("div",{staticClass:"mt-4 text-subtitle-1 font-weight-light"},[e._v("Drop your image to here")])],1):n("div",{staticClass:"upload-field__normal"},[n("v-icon",{attrs:{size:"32"}},[e._v("mdi-image")]),e._v(" "),n("div",{staticClass:"text-subtitle-1 font-weight-light"},[e._v("Drag and drop or "),n("div",{on:{click:function(t){return e.$refs.picture_upload.click()}}},[e._v("browse")])])],1):n("div",{staticClass:"upload-field__image"},[n("div",{staticClass:"upload-field__image--remove"},[n("v-icon",{attrs:{color:"white"},on:{click:e.handelOnRemove}},[e._v("mdi-delete")])],1),e._v(" "),e.multiple||1!==e.localVal.length?e._e():n("v-img",{staticClass:"grey lighten-4",attrs:{src:e.localVal[0],width:"100%",height:"100%",contain:""}})],1)]),e._v(" "),n("div",{class:["upload-field__details",{"upload-field__details--hide":e.hideDetails}]},[e.errorBucket.length<1&&e.hint&&(e.persistentHint||e.isFocused)?n("VMessages",{attrs:{value:[e.hint]}}):e._e(),e._v(" "),n("VMessages",{attrs:{value:e.errorBucket,color:"error"}})],1)])}),[],!1,null,"b5ade68e",null);t.default=component.exports;x()(component,{VAvatar:w.a,VIcon:y.a,VImg:k.a,VMessages:C.a})},804:function(e,t,n){"use strict";n(761)},805:function(e,t,n){var r=n(55)(!1);r.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;500;600;700&display=swap);"]),r.push([e.i,".bbox__container[data-v-dc37180c]{display:flex;align-items:center;justify-content:center;background-color:rgba(0,0,0,.04)}",""]),e.exports=r},820:function(e,t){},821:function(e,t){},830:function(e,t){},831:function(e,t){},850:function(e,t){},852:function(e,t){},855:function(e,t){},856:function(e,t){},861:function(e,t){},868:function(e,t){},878:function(e,t,n){var content=n(987);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(56).default)("0fec4422",content,!0,{sourceMap:!1})},889:function(e,t,n){"use strict";n.r(t);var r=n(63);n(187),n(65),n(150),n(96),n(25),n(69),n(128),n(95),n(57),n(37),n(129),n(137),n(97);function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,d=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){c=!0,o=e},f:function(){try{d||null==n.return||n.return()}finally{if(c)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var d={name:"BoundingBoxCanvas",props:{width:{type:Number,default:100},height:{type:Number,default:100},src:{type:String,default:null},bboxes:{type:Array,default:function(){return[]}}},data:function(){return{stageConfig:{width:100,height:100,scaleX:.5,scaleY:.5},imageConfig:{image:null,width:100,height:100,x:0,y:0},shapes:[],imageFactor:1}},watch:{src:function(e){this.loadImage(e)},bboxes:function(e){this.loadBox(e)},width:function(e){this.updateStageSize()}},mounted:function(){this.loadImage(this.src),this.loadBox(this.bboxes)},methods:{loadImage:function(e){var t=this;if(e){var image=new Image;image.onload=function(){t.imageConfig.image=image,t.imageConfig.width=image.width,t.imageConfig.height=image.height,t.updateStageSize()},image.src=e}},loadBox:function(e){if(Array.isArray(e)){var t=e.map((function(e,i){return{rotation:0,x:e.rectangle.x,y:e.rectangle.y,width:e.rectangle.width,height:e.rectangle.height,stroke:e.color,fill:e.color,strokeWidth:5,opacity:.6,$index:e.$index,$id:e.id}}));this.shapes=t}},updateStageSize:function(){var e=Math.min(this.width/this.imageConfig.width,this.height/this.imageConfig.height);this.imageFactor=e;var t=this.calculateAspectRatioFit(this.imageConfig.width,this.imageConfig.height,this.width,this.height);this.stageConfig.width=t.width,this.stageConfig.height=t.height,this.stageConfig.scaleX=1*e,this.stageConfig.scaleY=1*e},calculateAspectRatioFit:function(e,t,n,r){var o=Math.min(n/e,r/t);return{width:e*o,height:t*o}},getImageData:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,l,d,c,f,v,h,m,_,x,w,img;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.$refs.background.getNode(),l=r.width()/t.stageConfig.width,d=r.height()/t.stageConfig.height,c=[],f=o(e),n.prev=5,f.s();case 7:if((v=f.n()).done){n.next=19;break}return h=v.value,m=parseInt(Math.round(h.rectangle.x/l)),_=parseInt(Math.round(h.rectangle.y/d)),x=parseInt(Math.round(h.rectangle.width/l)),w=parseInt(Math.round(h.rectangle.height/d)),n.next=15,r.toImage({x:m,y:_,width:x,height:w,mimeType:"image/jpeg"});case 15:img=n.sent,c.push(img);case 17:n.next=7;break;case 19:n.next=24;break;case 21:n.prev=21,n.t0=n.catch(5),f.e(n.t0);case 24:return n.prev=24,f.f(),n.finish(24);case 27:return n.abrupt("return",c);case 28:case"end":return n.stop()}}),n,null,[[5,21,24,27]])})))()},reset:function(){this.imageConfig.image=null,this.shapes=[]}}},c=(n(804),n(138)),component=Object(c.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bbox__container",style:{width:e.width+"px",height:e.height+"px"}},[n("v-stage",{ref:"stage",staticClass:"bbox__stage",attrs:{config:e.stageConfig}},[n("v-layer",{ref:"layer"},[n("v-image",{ref:"background",attrs:{config:e.imageConfig}}),e._v(" "),e._l(e.shapes,(function(t){return[n("v-rect",{key:"shape-"+t.$id,attrs:{config:t}}),e._v(" "),n("v-text",{key:"text-"+t.$id,attrs:{config:{text:"P"+(t.$index+1),x:t.x+4,y:t.y+4,fontSize:14,fill:"#ffffff"}}})]}))],2)],1)],1)}),[],!1,null,"dc37180c",null);t.default=component.exports},986:function(e,t,n){"use strict";n(878)},987:function(e,t,n){var r=n(55)(!1);r.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;500;600;700&display=swap);"]),r.push([e.i,".page-btn--up[data-v-196cba2f]{transform:rotate(-180deg)}.page-btn--down[data-v-196cba2f]{transform:rotate(0deg)}.page__container[data-v-196cba2f]{height:100%;width:100%;margin:auto}.page-database[data-v-196cba2f],.page-filter[data-v-196cba2f],.page-workspace[data-v-196cba2f]{padding-top:24px}.page-database__container[data-v-196cba2f],.page-filter__container[data-v-196cba2f],.page-workspace-item[data-v-196cba2f]{width:100%;max-width:800px;margin:auto;padding-left:16px;padding-right:16px}.page-database--collapse[data-v-196cba2f]{height:0!important;opacity:0!important;padding:0!important;border:none!important}.page-database--expand[data-v-196cba2f]{border-top:thin solid rgba(0,0,0,.12);overflow:hidden;height:120px;padding:16px;transition:height .5s,padding .5s}.page-database__content[data-v-196cba2f]{padding-top:8px;display:flex}.page-database-upload-btn[data-v-196cba2f]{width:72px;height:58px;padding:4px 8px;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#e8f0fe;border-radius:4px;cursor:pointer;position:relative}.page-database-upload-btn--block[data-v-196cba2f]{width:100%;height:32px;flex-direction:row}.page-database-upload-btn--block>.v-icon[data-v-196cba2f]{margin-right:4px}.page-database-upload-btn>input[data-v-196cba2f]{display:none}.page-database-upload-btn>.page-database-upload-btn__text[data-v-196cba2f],.page-database-upload-btn>i[data-v-196cba2f]{color:#1967d2}.page-database-upload-btn>.page-database-upload-btn__text[data-v-196cba2f]{font-size:.8rem}.page-database-upload-btn[data-v-196cba2f]:hover{background-color:#d2e3fc}.page-database-upload-btn[data-v-196cba2f]:disabled{background-color:#eee;cursor:not-allowed}.page-database-upload-btn:disabled>.page-database-upload-btn__text[data-v-196cba2f],.page-database-upload-btn:disabled>i[data-v-196cba2f]{color:#888!important}.page-database-list[data-v-196cba2f]{overflow:hidden;overflow-x:auto;margin-left:8px;display:flex}.page-database-item[data-v-196cba2f]{width:58px;height:58px;position:relative}.page-database-item:hover .page-database-item__remove[data-v-196cba2f]{display:flex;align-items:center;justify-content:center;cursor:pointer}.page-database-item__remove[data-v-196cba2f]{display:none;position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.2)}.page-database-list>.page-database-item+.page-database-item[data-v-196cba2f]{margin-left:4px}.page-filter--collapse[data-v-196cba2f]{height:0!important;opacity:0!important;padding:0!important}.page-filter--expand[data-v-196cba2f]{overflow:hidden;height:164px;padding:16px;transition:height .5s,padding .5s}.page-workspace-list[data-v-196cba2f]{overflow:hidden;overflow-y:auto;padding-bottom:16px;padding-top:16px}.page-workspace-card__content[data-v-196cba2f]{display:flex}.page-workspace-card__canvas[data-v-196cba2f]{flex:0}.page-workspace-card__output[data-v-196cba2f]{flex:1}.page-workspace-list>.page-workspace-item+.page-workspace-item[data-v-196cba2f]{margin-top:16px}.page-workspace-boxes-results[data-v-196cba2f]{overflow:hidden;overflow-y:auto}.page-workspace-boxes__title[data-v-196cba2f]{font-size:1.1rem;font-weight:600}.page-workspace-boxes__item[data-v-196cba2f]{display:flex;align-items:center;padding:16px 0}.page-workspace-boxes__color-box[data-v-196cba2f]{width:22px;height:22px;min-height:100%;margin-right:8px;font-size:.65rem;display:flex;align-items:center;justify-content:center;color:#fff}.page-workspace-boxes__label[data-v-196cba2f]{margin-right:8px;max-width:30%;width:30%;font-size:.8rem}.page-workspace-boxes__percent[data-v-196cba2f]{flex:1}.page-workspace-boxes__score[data-v-196cba2f]{padding-left:8px;font-size:.8rem}.page-footer[data-v-196cba2f]{position:fixed;bottom:0;left:0;right:0;display:flex;align-items:center;justify-content:flex-end;padding-left:8px;padding-right:8px;padding-bottom:8px}.page-footer__text[data-v-196cba2f]{font-size:.9rem;font-weight:400;color:#aaa}.page-temp-upload[data-v-196cba2f]{position:absolute;top:0;left:0;z-index:-1}.page__overlay-box[data-v-196cba2f]{min-width:320px;text-align:center;background-color:#fff;padding:32px 16px;color:#212121;border-radius:4px;white-space:pre-wrap;word-wrap:break-word}@media screen and (max-width:320px){.page-database--expand[data-v-196cba2f]{height:161px}}",""]),e.exports=r}}]);